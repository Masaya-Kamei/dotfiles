#!/bin/zsh

find_root() { find / -name System -prune -o $* -print 2>/dev/null }
git_commit_m() { git commit -m "$*" }

makescript() {
	if [ $# -ne 2 ]; then
		echo "Usage: makecmd [HistSize] [CommandName]"
		return 0
	fi
	count=$1
	name=$2
	expr $count + 1 > /dev/null 2>&1
	if [ $? -eq 2 ] ; then
		echo "Usage: makecmd [HistSize] [CommandName]"
		return 0
	fi
	if [ -e $name ]; then
		echo "File exsits!"
		return 0
	fi
	touch $name
	history -$count | cut -d " " -f 5- >> $name
	chmod a+x $name
}

google() {
    if [ $(echo $1 | grep "^-[cfs]$") ]; then
        local opt=$1
        shift
    fi
    local url="https://google.co.jp/search?q=${*// /+}"
	open $url -a "Google Chrome"
}

find_memo_txt() {
	d=~/Documents/memo
	grep -rin $* --include='*.txt' $d
	if [ $? -eq 0 ]; then
		echo -n $* | pbcopy
		code ~/Documents/memo
		# 行数を開くため、grep -l は使用しない
		grep -rinE $* --include='*.txt' $d | cut -d ":" -f -2 | xargs code -g
	fi
}

find_memo_title() {
	# "~/Documents/memo" とダブルクォーテーションで囲むとうまくいかない
	d=~/Documents/memo
	# cut コマンドの終了ステータスを使わないようにするため、一度変数に入れる
	g=`grep -rinE "\[-.*$*.*-\]" --include='*.txt' $d`
	if [ $? -eq 1 ]; then
		return 0
	fi
	echo $g | cut -d "	" -f 1
	echo -n $* | pbcopy
	code $d
	grep -rinE "\[-.*$*.*-\]" --include='*.txt' $d | cut -d ":" -f -2 | xargs code -g
}

find_sites_title() {
	d=~/Documents/sites
	t=translate.google.com
	# p = ^(?=.*$*)(?!.*$t).*$		($* は含むが、$t は含まない)
	# p はシングルクォーテーションで囲まれた文字列となる
	p=`echo -n \^\(\?=\.\*$*\)\(\?\!\.\*$t\)\.\*\$`
	# ! を使用する際は, ダブルクォーテーションではなく、シングルクォーテーションで囲む
	# ! -> !の次にくる文字列から始まる一番最近使用したコマンドを自動で呼び出す
	g=`ggrep -riP $p --include='*.html' $d`
	if [ $? -eq 1 ]; then
		return 0
	fi
	echo $g | sed -r "s/.*>(.*)<\/A>/\1/"
	echo -n $* | pbcopy
	# -P :perl正規表現 (拡張正規表現より、機能が多い)
	ggrep -riPl $p --include='*.html' $d | xargs open
}

find_sites_html() {
	d=~/Documents/sites
	t=translate.google.com
	p=`echo -n \^\(\?=\.\*$*\)\(\?\!\.\*$t\)\.\*\$`
	g=`ggrep -riP $p --include='*.html' $d`
	if [ $? -eq 1 ]; then
		return 0
	fi
	echo $g | sed -r "s/.*>(.*)<\/A>/\1/"
	echo -n $* | pbcopy
	ggrep -riP $p --include='*.html' $d | sed -r "s/.*HREF=\"(.*)\" ADD.*/\1/" | xargs open
}
